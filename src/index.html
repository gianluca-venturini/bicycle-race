<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>Project2</title>
    <link rel="stylesheet" href="/style/leaflet.css" />
    <link rel="stylesheet" href="/style/app.css" />
    <link rel="stylesheet" href="/style/chart.css" />
    <script src="/library/jquery-1.11.1.min.js"></script>
    <script src="/library/leaflet.js"></script>
    <script src="/library/d3.v3.min.js"></script>
    <script src="/library/geojson-utils.js"></script>
    <script src="/library/graphic_manager.js"></script>
    <script src="/library/data_manager.js"></script>
    <script src="/library/controls.js"></script>
    <script src="/library/marker.js"></script>
    <script src="/library/BarChart.js"></script>
    <script src="/library/LineChart.js"></script>
    <style>
        #map {
            height: 100%;
        }
        .submap {
            border: solid 1px black;
        }
        /* Chart style */ 
        .daysOfWeek{
            fill:rgba(160,210,180,0.8);
        }
        .hourOfDayMany{
            fill:none;
            stroke-width:1px;
        }
        .dayOfYearMany{
            fill:none;
            stroke-width:1px;
        }
        .hourOfDay{
            fill:none;
            stroke:rgba(200,100,90,0.9);
            stroke-width:1px;
        }
        .hourOfDayArea{
            fill:rgba(200,100,90,0.9);
            stroke:rgba(200,100,90,0.9);
            stroke-width:1px;
        }

        /* Other style */
        .blur {
            -webkit-filter: blur(10px);
        }

        /* Cursor style */
        .pointer {
            cursor: pointer
        }
        .default {
            cursor: default
        }
    </style>
</head>

<body>
    <div id="lol">
        <div id="map"></div>
    </div>

    <script>
        var gm = new GraphicManager("map");
        gm.createMap("grey");

         // Create two svg with graphic manager
         //var svgControls = gm.addSvg(0, 0, 0.07, 0.5);
        var svgLayerControl = gm.addSvg(0, 0, 0.07, 0.12);
        var svgSelectionControl = gm.addSvg(0, 0.125, 0.07, 0.12); // y taken from previous svg's height
        var svgEnableCalendarControl = gm.addSvg(0, 0.12 * 2 + 0.01, 0.07, 0.06);

        var svgDayControl = gm.addSvg(0.072, 0, 0.07, 0.24 + 0.005);
         //var svgZoomControl = gm.addSvg(0, 0.32, 0.04, 0.24);

        gm.updateWindow();

         // Allocate javascript objects that will manage this SVGS
        var layerControl = new LayerControl(svgLayerControl);
        var selectionControl = new SelectionControl(svgSelectionControl);
        var enableCalendarControl = new EnableCalendarControl(svgEnableCalendarControl);
        var dayControl = new DayControl(svgDayControl);
        var zoomControl = new ZoomControl();
        var stationControl = new StationControl();

        selectionControl.setCallbackShowCA(gm.addCommunityMap.bind(gm));
        selectionControl.setCallbackHideCA(gm.removeCommunityMap.bind(gm));

        zoomControl.setCallbackZoomIn(gm.zoomIn.bind(gm));
        zoomControl.setCallbackZoomOut(gm.zoomOut.bind(gm));

         // Draw the SVGs
        layerControl.draw();
        selectionControl.draw();
        enableCalendarControl.draw();
        dayControl.draw();

         // Set interactions
         //c1.setPressCallback(c2.changeColor.bind(c2));
         //c2.setPressCallback(c1.changeColor.bind(c1));
        layerControl.setCallback("text_layer_1", gm.changeLayer.bind(gm, "normal"));
        layerControl.setCallback("text_layer_2", gm.changeLayer.bind(gm, "grey"));

        gm.addExternalSVGs(gm.updateWindow.bind(gm));

         //gm.addSubMap(0.6, 0.1, 0.4, 0.4, "map2", "satellitar");
         //gm.addSubMap(0, 0, 0.07, 0.12, "map3", "lol");

        /*
            Graph integration
        */
        var bar1 = gm.addSvg(0.6 ,0, 0.30, 0.20);  // Day of the week
        var barChart1 = new BarChart(bar1);
        gm.dayWeekBarGraph = barChart1;

        var line1 = gm.addSvg(0.6 , 0.25, 0.30, 0.20);  // Hour of the day sum
        var lineChart1 = new LineChart(line1);
        gm.bikesHourDay = lineChart1;

        var line2 = gm.addSvg(0.6 , 0.50, 0.30, 0.20);  // Hour of the day multiple stations
        var lineChart2 = new LineChart(line2);
        gm.bikesHourDayComparison = lineChart2;

        var line3 = gm.addSvg(0.6 , 0.75, 0.30, 0.20);  // Day of the year, multiple stations
        var lineChart3 = new LineChart(line3);
        gm.bikesDayYearComparison = lineChart3;

        gm.drawMarkers("popularity");
        gm.updateWindow();

         // Need this call in  order to inform the graphics manager that something changed
        window.onresize = gm.updateWindow.bind(gm);
    </script>
</body>

</html>